---
layout: page
title: laravel-security
description: Runs OWASP security audits and fixes vulnerabilities
nav_active: Agents
back_url: /agents.html
back_text: All Agents
---

<div class="mb-8">
    <div class="flex items-center gap-3 mb-4">
        <span class="category-badge badge-quality">Quality</span>
    </div>
    <h1 class="text-3xl font-bold mb-2">laravel-security</h1>
    <p class="text-xl text-muted-foreground">Runs OWASP security audits and fixes vulnerabilities</p>
</div>

<div class="prose prose-neutral dark:prose-invert max-w-none">
    <h2>Overview</h2>
    <p>The <strong>laravel-security</strong> agent performs comprehensive security audits based on OWASP guidelines. It identifies vulnerabilities like SQL injection, XSS, CSRF issues, and provides fixes following Laravel security best practices.</p>

    <h2>Responsibilities</h2>
    <ul>
        <li><strong>OWASP Audit</strong> - Check against OWASP Top 10 vulnerabilities</li>
        <li><strong>SQL Injection Detection</strong> - Find raw queries and unsafe bindings</li>
        <li><strong>XSS Prevention</strong> - Identify unescaped output in Blade templates</li>
        <li><strong>CSRF Verification</strong> - Ensure proper token usage</li>
        <li><strong>Mass Assignment</strong> - Check for unprotected fillable properties</li>
        <li><strong>Security Headers</strong> - Configure proper HTTP security headers</li>
    </ul>

    <h2>Security Audit Process</h2>
    <div class="not-prose">
        <div class="bg-muted/50 rounded-lg p-6 border border-border">
            <pre class="text-sm text-foreground">
┌─────────────────────────────────────────────────────────────┐
│                    Security Audit Flow                       │
├─────────────────────────────────────────────────────────────┤
│  1. Scan Controllers                                        │
│     → Check for raw queries                                 │
│     → Verify authorization calls                            │
│     → Validate input handling                               │
├─────────────────────────────────────────────────────────────┤
│  2. Scan Blade Templates                                    │
│     → Find {!! !!} usage (unescaped output)                │
│     → Check @csrf in forms                                  │
│     → Verify @method for non-GET forms                      │
├─────────────────────────────────────────────────────────────┤
│  3. Scan Models                                             │
│     → Check $fillable vs $guarded                          │
│     → Review relationship security                          │
├─────────────────────────────────────────────────────────────┤
│  4. Check Configuration                                     │
│     → APP_DEBUG setting                                     │
│     → Session security options                              │
│     → CORS configuration                                    │
└─────────────────────────────────────────────────────────────┘
            </pre>
        </div>
    </div>

    <h2>Vulnerability Detection Examples</h2>
    <pre class="language-php"><code class="language-php">// VULNERABILITY: SQL Injection
$users = DB::select("SELECT * FROM users WHERE name = '$name'");

// FIX: Parameterized query
$users = DB::select("SELECT * FROM users WHERE name = ?", [$name]);

// VULNERABILITY: XSS (unescaped output)
{!! $userInput !!}

// FIX: Escaped output
{{ $userInput }}

// VULNERABILITY: Mass Assignment
$user = User::create($request->all());

// FIX: Explicit fields
$user = User::create($request->only(['name', 'email']));</code></pre>

    <h2>Security Headers Middleware</h2>
    <pre class="language-php"><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class SecurityHeaders
{
    public function handle(Request $request, Closure $next)
    {
        $response = $next($request);

        // Prevent MIME type sniffing
        $response->headers->set('X-Content-Type-Options', 'nosniff');

        // Prevent clickjacking
        $response->headers->set('X-Frame-Options', 'SAMEORIGIN');

        // Enable XSS filter
        $response->headers->set('X-XSS-Protection', '1; mode=block');

        // Control referrer information
        $response->headers->set('Referrer-Policy', 'strict-origin-when-cross-origin');

        // Content Security Policy
        $response->headers->set('Content-Security-Policy', "default-src 'self'");

        return $response;
    }
}</code></pre>

    <h2>Audit Report Format</h2>
    <div class="overflow-x-auto not-prose">
        <table class="w-full text-sm">
            <thead>
                <tr class="border-b border-border">
                    <th class="text-left py-3 px-4 font-medium">Severity</th>
                    <th class="text-left py-3 px-4 font-medium">Issue</th>
                    <th class="text-left py-3 px-4 font-medium">File</th>
                    <th class="text-left py-3 px-4 font-medium">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><span class="text-red-500 font-bold">CRITICAL</span></td>
                    <td class="py-3 px-4">SQL Injection</td>
                    <td class="py-3 px-4"><code>UserController.php:45</code></td>
                    <td class="py-3 px-4">Use parameterized query</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><span class="text-orange-500 font-bold">HIGH</span></td>
                    <td class="py-3 px-4">XSS Vulnerability</td>
                    <td class="py-3 px-4"><code>show.blade.php:23</code></td>
                    <td class="py-3 px-4">Use {{ }} not {!! !!}</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><span class="text-yellow-500 font-bold">MEDIUM</span></td>
                    <td class="py-3 px-4">Missing CSRF</td>
                    <td class="py-3 px-4"><code>create.blade.php:12</code></td>
                    <td class="py-3 px-4">Add @csrf directive</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><span class="text-blue-500 font-bold">LOW</span></td>
                    <td class="py-3 px-4">Debug Mode On</td>
                    <td class="py-3 px-4"><code>.env</code></td>
                    <td class="py-3 px-4">Set APP_DEBUG=false</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>Password Validation Setup</h2>
    <pre class="language-php"><code class="language-php">use Illuminate\Validation\Rules\Password;

// In a Form Request or controller
$request->validate([
    'password' => [
        'required',
        'confirmed',
        Password::min(8)
            ->mixedCase()
            ->numbers()
            ->symbols()
            ->uncompromised(), // Check against breach databases
    ],
]);</code></pre>

    <h2>Invoked By Commands</h2>
    <ul>
        <li><a href="{{ '/commands/security-audit.html' | relative_url }}" class="text-primary hover:underline">/laravel-agent:security:audit</a> - Run security audit</li>
        <li><a href="{{ '/commands/review-audit.html' | relative_url }}" class="text-primary hover:underline">/laravel-agent:review:audit</a> - Full codebase audit</li>
    </ul>

    <h2>OWASP Top 10 Coverage</h2>
    <div class="overflow-x-auto not-prose">
        <table class="w-full text-sm">
            <thead>
                <tr class="border-b border-border">
                    <th class="text-left py-3 px-4 font-medium">OWASP</th>
                    <th class="text-left py-3 px-4 font-medium">What's Checked</th>
                </tr>
            </thead>
            <tbody>
                <tr class="border-b border-border">
                    <td class="py-3 px-4">A01: Broken Access Control</td>
                    <td class="py-3 px-4">Authorization calls, policy usage, route protection</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4">A02: Cryptographic Failures</td>
                    <td class="py-3 px-4">Password hashing, token generation, encryption usage</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4">A03: Injection</td>
                    <td class="py-3 px-4">SQL, command, LDAP injection patterns</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4">A05: Security Misconfiguration</td>
                    <td class="py-3 px-4">APP_DEBUG, session settings, headers</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4">A07: Authentication Failures</td>
                    <td class="py-3 px-4">Rate limiting, lockout, password policies</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>False Positive Filtering</h2>
    <p>The agent validates findings using a confidence pipeline:</p>
    <ol>
        <li><strong>Code Exists?</strong> - Verify the pattern actually exists in code</li>
        <li><strong>Context OK?</strong> - Check if in test file, constant, or framework-handled</li>
        <li><strong>Confidence ≥80%?</strong> - Only report high-confidence issues</li>
    </ol>
    <p>Philosophy: <em>"When in doubt, leave it out."</em></p>

    <h2>Package Integration</h2>
    <p>Integrates with security packages:</p>
    <ul>
        <li><strong>spatie/laravel-csp</strong> - Content Security Policy configuration</li>
        <li><strong>spatie/crypto</strong> - RSA encryption and digital signatures</li>
        <li><strong>enlightn/enlightn</strong> - Comprehensive security analysis</li>
        <li><strong>grazulex/laravel-devtoolbox</strong> - Unprotected route detection</li>
    </ul>

    <h2>Guardrails</h2>
    <p>The security agent enforces strict rules:</p>
    <ul>
        <li><strong>NEVER</strong> commit secrets or credentials</li>
        <li><strong>NEVER</strong> disable CSRF for web routes</li>
        <li><strong>NEVER</strong> trust user input without validation</li>
        <li><strong>ALWAYS</strong> use parameterized queries</li>
        <li><strong>ALWAYS</strong> escape output in views</li>
        <li><strong>ALWAYS</strong> validate and sanitize uploads</li>
        <li><strong>NEVER</strong> report issues with confidence &lt; 80%</li>
    </ul>

    <h2>See Also</h2>
    <ul>
        <li><a href="{{ '/skills/laravel-security.html' | relative_url }}" class="text-primary hover:underline">laravel-security skill</a> - Auto-invoked security expertise</li>
        <li><a href="{{ '/agents/laravel-auth.html' | relative_url }}" class="text-primary hover:underline">laravel-auth</a> - Authentication setup</li>
    </ul>
</div>
