---
layout: page
title: laravel-auth
description: Setup authentication with policies, gates, roles, Sanctum
nav_active: Skills
back_url: /skills.html
back_text: All Skills
---

<div class="mb-8">
    <div class="flex items-center gap-4 mb-4">
        <div class="w-12 h-12 rounded-[var(--radius)] bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
        </div>
        <div>
            <h1 class="text-3xl font-bold">laravel-auth</h1>
            <p class="text-muted-foreground">Auto-invoked skill</p>
        </div>
    </div>
    <p class="text-xl text-muted-foreground">Setup authentication with policies, gates, roles, Sanctum</p>
</div>

<div class="prose prose-neutral dark:prose-invert max-w-none">
    <h2>Trigger Keywords</h2>
    <p>This skill automatically activates when Claude detects these keywords:</p>
    <div class="flex flex-wrap gap-2 not-prose mb-6">
        <span class="trigger-tag">auth</span>
        <span class="trigger-tag">login</span>
        <span class="trigger-tag">permission</span>
        <span class="trigger-tag">policy</span>
        <span class="trigger-tag">gate</span>
        <span class="trigger-tag">sanctum</span>
        <span class="trigger-tag">role</span>
    </div>

    <h2>Overview</h2>
    <p>The <strong>laravel-auth</strong> skill provides expertise for implementing authentication and authorization. It covers Laravel's built-in auth, Sanctum for APIs, policies for model authorization, and role-based access control.</p>

    <h2>What This Skill Provides</h2>
    <ul>
        <li><strong>Authentication</strong> - Session-based, token-based, social login</li>
        <li><strong>Authorization</strong> - Policies, gates, middleware</li>
        <li><strong>Sanctum</strong> - SPA authentication and API tokens</li>
        <li><strong>Roles & Permissions</strong> - Spatie or custom implementations</li>
        <li><strong>Multi-tenancy</strong> - Tenant isolation patterns</li>
        <li><strong>2FA</strong> - Two-factor authentication setup</li>
    </ul>

    <h2>Example Conversations</h2>
    <pre class="language-bash"><code class="language-bash"># Setting up auth
"Set up authentication for my SPA using Sanctum"

# Authorization policies
"Create a policy so users can only edit their own posts"

# Role-based access
"Implement admin, editor, and viewer roles with different permissions"

# API authentication
"How do I protect my API routes with Sanctum tokens?"</code></pre>

    <h2>Policy Example</h2>
    <pre class="language-php"><code class="language-php">&lt;?php

namespace App\Policies;

use App\Models\Post;
use App\Models\User;

class PostPolicy
{
    // Runs before all other checks
    public function before(User $user, string $ability): ?bool
    {
        if ($user->isAdmin()) {
            return true; // Admins can do anything
        }
        return null; // Continue to specific check
    }

    public function view(User $user, Post $post): bool
    {
        return $post->published || $user->id === $post->user_id;
    }

    public function update(User $user, Post $post): bool
    {
        return $user->id === $post->user_id;
    }

    public function delete(User $user, Post $post): bool
    {
        return $user->id === $post->user_id
            && $post->comments()->count() === 0;
    }
}

// Usage in controller
public function update(Request $request, Post $post)
{
    $this->authorize('update', $post);
    // ...
}</code></pre>

    <h2>Gate vs Policy</h2>
    <div class="overflow-x-auto not-prose">
        <table class="w-full text-sm">
            <thead>
                <tr class="border-b border-border">
                    <th class="text-left py-3 px-4 font-medium">Use</th>
                    <th class="text-left py-3 px-4 font-medium">When</th>
                </tr>
            </thead>
            <tbody>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><strong>Gates</strong></td>
                    <td class="py-3 px-4">Simple actions not tied to a model (e.g., "access admin panel")</td>
                </tr>
                <tr class="border-b border-border">
                    <td class="py-3 px-4"><strong>Policies</strong></td>
                    <td class="py-3 px-4">Model-specific authorization (CRUD on Post, User, etc.)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>Sanctum API Authentication</h2>
    <pre class="language-php"><code class="language-php">// Creating a token with abilities
$token = $user->createToken('api-token', ['posts:read', 'posts:write']);

// Protecting routes
Route::middleware('auth:sanctum')->group(function () {
    Route::get('/user', fn () => auth()->user());
});

// Checking token abilities
if ($user->tokenCan('posts:write')) {
    // User can write posts
}

// In controller
public function store(Request $request)
{
    if (!$request->user()->tokenCan('posts:write')) {
        abort(403);
    }
}</code></pre>

    <h2>Encrypted Model Attributes</h2>
    <pre class="language-php"><code class="language-php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

final class User extends Model
{
    // Using built-in cast
    protected function casts(): array
    {
        return [
            'api_key' =&gt; 'encrypted',
            'settings' =&gt; 'encrypted:array',
        ];
    }
}

// Manual encryption
use Illuminate\Support\Facades\Crypt;

$encrypted = Crypt::encryptString($sensitive);
$decrypted = Crypt::decryptString($encrypted);</code></pre>

    <h2>Common Pitfalls</h2>
    <pre class="language-php"><code class="language-php">// 1. Storing Plain Passwords - Always use Hash
// BAD
$user-&gt;password = $request-&gt;password;

// GOOD
$user-&gt;password = Hash::make($request-&gt;password);

// 2. No Policy Registration - Register in AuthServiceProvider
protected $policies = [
    Post::class =&gt; PostPolicy::class,
];

// 3. Missing Middleware - Protect routes
Route::middleware('auth')-&gt;group(function () {
    // Protected routes
});

// 4. Token Exposure - Never log tokens
// BAD
Log::info('Token: ' . $token-&gt;plainTextToken);

// 5. No Rate Limiting - Rate limit login attempts
Route::post('/login', [AuthController::class, 'login'])
    -&gt;middleware('throttle:5,1');

// 6. Session Fixation - Regenerate session after login
$request-&gt;session()-&gt;regenerate();</code></pre>

    <h2>Package Integration</h2>
    <ul>
        <li><strong>laravel/sanctum</strong> - API token authentication</li>
        <li><strong>laravel/passport</strong> - Full OAuth2 server</li>
        <li><strong>spatie/laravel-permission</strong> - Role & permission management</li>
        <li><strong>laravel/fortify</strong> - Authentication backend</li>
    </ul>

    <h2>Best Practices</h2>
    <ul>
        <li>Use policies for model authorization</li>
        <li>Use gates for general abilities</li>
        <li>Rate limit authentication endpoints</li>
        <li>Use HTTPS in production</li>
        <li>Regenerate session after login</li>
        <li>Implement proper logout</li>
    </ul>

    <h2>Authorization Middleware</h2>
    <pre class="language-php"><code class="language-php">// In routes
Route::put('/posts/{post}', [PostController::class, 'update'])
    ->middleware('can:update,post');

// Or in controller constructor
public function __construct()
{
    $this->authorizeResource(Post::class, 'post');
}</code></pre>

    <h2>Related Commands</h2>
    <ul>
        <li><a href="{{ '/commands/auth-setup.html' | relative_url }}" class="text-primary hover:underline">/laravel-agent:auth:setup</a> - Setup authentication system</li>
    </ul>

    <h2>Related Agent</h2>
    <ul>
        <li><a href="{{ '/agents/laravel-auth.html' | relative_url }}" class="text-primary hover:underline">laravel-auth</a> - Authentication specialist</li>
    </ul>
</div>
